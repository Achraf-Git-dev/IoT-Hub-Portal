@page "/devicedetail/{DeviceID}"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using AzureIoTHub.Portal.Shared
@attribute [Authorize]
@inject HttpClient Http

<MudContainer MaxWidth="MaxWidth.False">
    <MudGrid>
        <MudItem xs="12">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h4">Device detail</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudText>@Device.DeviceID</MudText>
                        </MudItem>
                        <MudItem md="6" xs="12">
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>Location Asset ID : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudTextField @bind-Value="@Device.LocationCode" Class="custom-disabled" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Outlined"></MudTextField>
                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>IoT Asset ID : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudTextField @bind-Value="@Device.AssetID" Class="custom-disabled" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Outlined"></MudTextField>
                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>Status : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudRadioGroup @bind-SelectedOption="@DeviceState" Style="display:flex;align-items:baseline">
                                        <MudItem md="4" sm="12">
                                            <MudRadio Option="@("true")" Color="Color.Primary">Enabled</MudRadio>
                                        </MudItem>
                                        <MudItem md="4" sm="12">
                                            <MudRadio Option="@("false")" Color="Color.Primary">Disabled</MudRadio>
                                        </MudItem>
                                    </MudRadioGroup>
                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>Connection state : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    @if (Device.IsConnected)
                                    {
                                        <MudIcon Icon="@Icons.Filled.Wifi" Color="Color.Success" />
                                    }
                                    else
                                    {
                                        <MudIcon Icon="@Icons.Filled.WifiOff" Color="Color.Error" />
                                    }
                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>Last activity time : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudTextField @bind-Value="@Device.LastActivityDate" Class="custom-disabled" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Outlined"></MudTextField>
                                </MudItem>
                            </MudItem>
                        </MudItem>
                        
                        <MudItem md="6" xs="12">
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>Type : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudSelect T="string" Label="LoRa Device" Variant="Variant.Filled" Dense="true" ReadOnly="true">
                                        <MudSelectItem Value="@("LoRa Device")" />
                                    </MudSelect>
                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>Model Type : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudTextField @bind-Value="@Device.ModelType" Class="custom-disabled" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Outlined"></MudTextField>
                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>OTAA AppEUI : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    @*<MudTextField @bind-Value="@Device.AppEUI" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Filled"></MudTextField>*@
                                    <MudTextField @bind-Value="@Device.AppEUI" Class="custom-disabled" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Outlined"></MudTextField>

                                </MudItem>
                            </MudItem>
                            <MudItem xs="12" Class="custom-form">
                                <MudItem md="3" sm="12">
                                    <MudText>OTAA AppKey : </MudText>
                                </MudItem>
                                <MudItem md="9" sm="12">
                                    <MudTextField @bind-Value="@Device.AppKey" Class="custom-disabled" Margin="Margin.Dense" ReadOnly="true" Variant="Variant.Outlined"></MudTextField>
                                </MudItem>
                            </MudItem>


                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>

    </MudGrid>
</MudContainer>

@code {

    [Parameter]
    public string DeviceID { get; set; }

    public string DeviceState { get; set; }

    private DeviceListItem Device { get; set; } = new DeviceListItem();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Device = await Http.GetFromJsonAsync<DeviceListItem>($"Devices/{DeviceID}");
            DeviceState = Device.IsEnabled.ToString();
        }
        catch (AccessTokenNotAvailableException exception)
        {
            exception.Redirect();
        }
    }
}

